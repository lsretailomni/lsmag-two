<?php
/**
 * THIS IS AN AUTOGENERATED FILE
 * DO NOT MODIFY
 * @codingStandardsIgnoreFile
 */

namespace Ls\Omni\Client\Ecommerce\Operation;

use Magento\Framework\App\ObjectManager;

class LSCRetailImageLink
{
    public string $baseUrl;
    public array $connectionParams;
    public string $companyName;
    public \Ls\Omni\Client\Ecommerce\Entity\ODataRequest_GetImageLink $request;
    public \Ls\Omni\Client\Ecommerce\Entity\LSCRetailImageLinkResponse $response;
    public \Ls\Omni\Helper\Data $dataHelper;

    public function __construct($baseUrl = '', $connectionParams = [], $companyName = '')
    {
        $this->baseUrl = $baseUrl;
        $this->connectionParams = $connectionParams;
        $this->companyName = $companyName;
        $this->dataHelper = ObjectManager::getInstance()->get(\Ls\Omni\Helper\Data::class);
    }

    public function execute(\Ls\Omni\Client\Ecommerce\Entity\ODataRequest_GetImageLink $request = null): \Ls\Omni\Client\Ecommerce\Entity\LSCRetailImageLinkResponse
    {
        if ( !is_null( $request ) ) {
            $this->setRequest( $request );
        }

        $response = $this->dataHelper->makeRequest(
            \Ls\Omni\Client\Ecommerce\Entity\ODataRequest_GetImageLink::ACTION_NAME,
            \Ls\Omni\Client\Ecommerce\Entity\LSCRetailImageLink::class,
            $request,
            $this->baseUrl,
            $this->connectionParams,
            ['company' => $this->companyName]
        );

        $response = $this->formatResponse($response);

        $this->setResponse($response);

        return $response;
    }

    public function formatResponse($data): \Ls\Omni\Client\Ecommerce\Entity\LSCRetailImageLinkResponse
    {
        if (isset($data['TableData']['TableDataUpd']['RecRefJson'])) {
            $recRef = $data['TableData']['TableDataUpd']['RecRefJson'];
        } elseif (isset($data['DataSet']['DataSetUpd']['DynDataSet'])) {
            $recRef = $data['DataSet']['DataSetUpd']['DynDataSet'];
        } else {
            $recRef = [];
        }

        if (isset($recRef['RecordFields'])) {
            $fieldsDefinition = $recRef['RecordFields'];
        } elseif (isset($recRef['DataSetFields'])) {
            $fieldsDefinition = $recRef['DataSetFields'];
        } else {
            $fieldsDefinition = [];
        }

        if (isset($recRef['Records'])) {
            $rows = $recRef['Records'];
        } elseif (isset($recRef['DataSetRows'])) {
            $rows = $recRef['DataSetRows'];
        } else {
            $rows = [];
        }


        foreach ($fieldsDefinition as $field) {
            $fields[$field['FieldIndex']] = $field['FieldName'];
        }
        $results = [];
        if (!empty($fields)) {
            foreach ($rows as $row) {
                $values = $row['Fields'] ?? [];
                $entry = new \Ls\Omni\Client\Ecommerce\Entity\LSCRetailImageLink();
                foreach ($values as $value) {
                    $entry->setData($fields[$value['FieldIndex']], $value['FieldValue']);
                }
                $results[] = $entry;
            }
        }

        return new \Ls\Omni\Client\Ecommerce\Entity\LSCRetailImageLinkResponse([
            'records' => $results,
            'status' => $data['Status'] ?? '',
            'errorText' => $data['ErrorText'] ?? '',
            'lastKey' => $data['LastKey'] ?? '',
            'lastEntryNo' => $data['LastEntryNo'] ?? 0,
            'endOfTable' => $data['EndOfTable'] ?? false
        ]);
    }

    public function setRequest(\Ls\Omni\Client\Ecommerce\Entity\ODataRequest_GetImageLink $request): self
    {
        $this->request = $request;
        return $this;
    }

    public function setResponse(\Ls\Omni\Client\Ecommerce\Entity\LSCRetailImageLinkResponse $response): self
    {
        $this->response = $response;
        return $this;
    }

    public function getRequest(): \Ls\Omni\Client\Ecommerce\Entity\ODataRequest_GetImageLink
    {
        return $this->request;
    }

    public function getResponse(): \Ls\Omni\Client\Ecommerce\Entity\LSCRetailImageLinkResponse
    {
        return $this->response;
    }
}