<?php
/**
 * THIS IS AN AUTOGENERATED FILE
 * DO NOT MODIFY
 * @codingStandardsIgnoreFile
 */

namespace Ls\Omni\Client\Ecommerce\Operation;

use Magento\Framework\App\ObjectManager;

class Currency
{
    public string $baseUrl;
    public array $connectionParams;
    public string $companyName;
    public \Ls\Omni\Client\Ecommerce\Entity\ODataRequest_GetCurrency $request;
    public \Ls\Omni\Client\Ecommerce\Entity\CurrencyResponse $response;
    public \Ls\Omni\Helper\Data $dataHelper;

    public function __construct($baseUrl = '', $connectionParams = [], $companyName = '')
    {
        $this->baseUrl = $baseUrl;
        $this->connectionParams = $connectionParams;
        $this->companyName = $companyName;
        $this->dataHelper = ObjectManager::getInstance()->get(\Ls\Omni\Helper\Data::class);
        $this->request = new \Ls\Omni\Client\Ecommerce\Entity\ODataRequest_GetCurrency();
    }

    public function execute(): \Ls\Omni\Client\Ecommerce\Entity\CurrencyResponse
    {
        $response = $this->dataHelper->makeRequest(
            \Ls\Omni\Client\Ecommerce\Entity\ODataRequest_GetCurrency::ACTION_NAME,
            \Ls\Omni\Client\Ecommerce\Entity\Currency::class,
            $this->request,
            $this->baseUrl,
            $this->connectionParams,
            ['company' => $this->companyName]
        );

        $response = $this->formatResponse($response);

        $this->setResponse($response);

        return $response;
    }

    public function formatResponse($data): \Ls\Omni\Client\Ecommerce\Entity\CurrencyResponse
    {
        if (isset($data['TableData']['TableDataUpd']['RecRefJson'])) {
            $recRef = $data['TableData']['TableDataUpd']['RecRefJson'];
        } elseif (isset($data['DataSet']['DataSetUpd']['DynDataSet'])) {
            $recRef = $data['DataSet']['DataSetUpd']['DynDataSet'];
        } else {
            $recRef = [];
        }

        if (isset($recRef['RecordFields'])) {
            $fieldsDefinition = $recRef['RecordFields'];
        } elseif (isset($recRef['DataSetFields'])) {
            $fieldsDefinition = $recRef['DataSetFields'];
        } else {
            $fieldsDefinition = [];
        }

        if (isset($recRef['Records'])) {
            $rows = $recRef['Records'];
        } elseif (isset($recRef['DataSetRows'])) {
            $rows = $recRef['DataSetRows'];
        } else {
            $rows = [];
        }


        foreach ($fieldsDefinition as $field) {
            $fields[$field['FieldIndex']] = $field['FieldName'];
        }
        $results = [];
        if (!empty($fields)) {
            foreach ($rows as $row) {
                $values = $row['Fields'] ?? [];
                $entry = new \Ls\Omni\Client\Ecommerce\Entity\Currency();
                foreach ($values as $value) {
                    $entry->setData($fields[$value['FieldIndex']], $value['FieldValue']);
                }
                $results[] = $entry;
            }
        }

        return new \Ls\Omni\Client\Ecommerce\Entity\CurrencyResponse([
            'records' => $results,
            'status' => $data['Status'] ?? '',
            'errorText' => $data['ErrorText'] ?? '',
            'lastKey' => $data['LastKey'] ?? '',
            'lastEntryNo' => $data['LastEntryNo'] ?? 0,
            'endOfTable' => $data['EndOfTable'] ?? false
        ]);
    }

    public function & setOperationInput(array $params = []) : \Ls\Omni\Client\Ecommerce\Entity\ODataRequest_GetCurrency
    {
        $this->setRequest(new \Ls\Omni\Client\Ecommerce\Entity\ODataRequest_GetCurrency($params));
        $request = $this->getRequest();

        return $request;
    }


    public function setRequest(\Ls\Omni\Client\Ecommerce\Entity\ODataRequest_GetCurrency $request): self
    {
        $this->request = $request;
        return $this;
    }

    public function setResponse(\Ls\Omni\Client\Ecommerce\Entity\CurrencyResponse $response): self
    {
        $this->response = $response;
        return $this;
    }

    public function getRequest(): \Ls\Omni\Client\Ecommerce\Entity\ODataRequest_GetCurrency
    {
        return $this->request;
    }

    public function getResponse(): \Ls\Omni\Client\Ecommerce\Entity\CurrencyResponse
    {
        return $this->response;
    }
}